# Example Output Files

This directory contains example output files generated by the lab analysis pipeline to demonstrate the new features and output formats.

## Files Overview

### Standard Output Files (Deduplicated)

- **`lab_result_matrix.csv`** - Wide format lab results (deduplicated)
  - Shows the standard patient × test type matrix
  - Each patient appears once per reference date
  - Contains the nearest lab result for each test type

- **`lab_date_matrix.csv`** - Wide format lab dates (deduplicated)
  - Corresponding collection dates for the lab results
  - Same structure as lab_result_matrix but with dates

- **`detailed_lab_results.csv`** - Detailed results with date differences (deduplicated)
  - Long format with one row per lab result
  - Includes date differences from reference date
  - Shows which result was selected as "nearest"

### New Output Files (v2.0.0)

- **`lab_results_long_format.csv`** - Long format with ALL lab results (including duplicates)
  - Complete dataset without any duplicate removal
  - Shows all lab results for each patient
  - Useful for comprehensive analysis

- **`lab_result_matrix_with_suffixes.csv`** - Wide format with MRN suffixes
  - Handles multiple test types per patient using MRN suffixes
  - Each unique combination gets a suffix (e.g., 12345_1, 12345_2)
  - Includes ORIGINAL_MRN column for reference

- **`lab_date_matrix_with_suffixes.csv`** - Wide format dates with MRN suffixes
  - Corresponding dates for the suffix-based matrix
  - Same structure as lab_result_matrix_with_suffixes but with dates

### Summary Files

- **`summary_statistics.csv`** - Analysis summary statistics
  - Processing metrics and counts
  - File dimensions and timing information

- **`lab_analysis_summary.txt`** - Text summary report
  - Human-readable summary of the analysis
  - Sample data preview

## Key Features Demonstrated

### 1. Duplicate Handling
The example shows how the pipeline handles patients with multiple lab results:

**Patient 12345** has multiple HEMOGLOBIN and CREATININE tests:
- Standard matrix: Shows only the nearest result (12.5, 1.2)
- Long format: Shows all results (12.5, 13.2 for HEMOGLOBIN; 1.2, 1.4 for CREATININE)
- Suffix matrix: Shows both results with unique identifiers (12345_1, 12345_2)

### 2. MRN Suffix System
The suffix system creates unique identifiers for multiple test types per patient:

```
ORIGINAL_MRN | UNIQUE_MRN | HEMOGLOBIN | CREATININE
-------------|------------|------------|------------
12345        | 12345_1    | 12.5       | 1.2
12345        | 12345_2    | 13.2       | 1.4
```

### 3. Data Completeness
- **Deduplicated files**: Focus on the most relevant result per test type
- **Long format**: Preserves all data without loss
- **Suffix matrices**: Handles complex cases with multiple test types per patient

## Usage Notes

- All files are in CSV format for easy viewing
- RDS versions are also generated for faster loading in R
- The pipeline automatically detects and uses cached RDS files
- Use `--force_reprocess` to override caching when needed

## File Relationships

```
lab_result_matrix.csv          ← Standard wide format (deduplicated)
lab_date_matrix.csv           ← Corresponding dates
detailed_lab_results.csv      ← Long format (deduplicated)
lab_results_long_format.csv   ← Long format (all data)
lab_result_matrix_with_suffixes.csv ← Wide format with suffixes
lab_date_matrix_with_suffixes.csv   ← Corresponding dates with suffixes
```

This structure provides maximum flexibility for different analysis needs while maintaining data integrity and completeness.
